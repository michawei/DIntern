/*
Angular Scroll Repeat v0.0.3 by @kstam
Copyright (c) 2014

Full source at https://github.com/kstam/ng-scroll-repeat

MIT License, https://github.com/kstam/ng-scroll-repeat/blob/master/LICENSE
*/
angular.module("ks.ngScrollRepeat",["ks.WindowService"]).directive("ngScrollRepeat",["$compile","WindowService",function(r,e){"use strict";var t=50,o=200,n=function(r,e){r.$$phase||r.$root.$$phase?e():r.$apply(e)},i=function(r){if(r.match(/limitTo/)||r.match(/startFrom/))throw new Error('"limitTo" and "startFrom" filters are not allowed in scroll-repeat directive')},l=function(r){var t=e.height(),o=r.offset().top-e.scrollTop()+r.height();return o-t},a=function(a,c){var s=c.ngScrollRepeat,u=s.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),p=u[2],f=c.pageSize?Number(c.pageSize):t,v=c.tolerance?Number(c.tolerance):o;return i(s),a.removeAttr("ng-scroll-repeat"),a.attr("ng-repeat",s+" | limitTo:visibleResults"),function(t,o){var i;t.visibleResults=f,r(o)(t),t.$watch(p,function(r){i=r.length,t.visibleResults=f},!0);var a=$(o[0]).parent();e.registerForScroll(t),t.$on(e.WINDOW_SCROLL,function(){var r=l(a);v>=r&&i>t.visibleResults&&n(t,function(){t.visibleResults+=f})})}};return{replace:!1,terminal:!0,priority:2e3,restrict:"A",compile:a}}]),angular.module("ks.WindowService",[]).factory("WindowService",["$window",function(r){var e=angular.element(r),t="WINDOW_SCROLL",o=[];return e.on("scroll",function(){var r;for(var e in o)r=o[e],r.$broadcast(t)}),{WINDOW_SCROLL:t,height:function(){return e.height()},scrollTop:function(){return e.scrollTop()},registerForScroll:function(r){if(!r||!angular.isFunction(r.$broadcast))throw new Error("Cannot register a non-scope object for scroll");o.push(r)}}}]);